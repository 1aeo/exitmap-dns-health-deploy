# exitmap DNS Health Validation Configuration
# Copy to config.env and customize. Never commit secrets!
#
# Usage:
#   cp config.env.example config.env
#   chmod 600 config.env
#   nano config.env

# =============================================================================
# CLOUDFLARE (Required for Pages deployment)
# =============================================================================
CLOUDFLARE_ACCOUNT_ID=your_account_id
CLOUDFLARE_API_TOKEN=your_api_token
PAGES_PROJECT_NAME=exitmap-dns
CUSTOM_DOMAIN=                              # Optional: exitdns.example.com

# =============================================================================
# STORAGE (Multi-backend with failover)
# =============================================================================
STORAGE_ORDER=do,r2                         # Primary, fallback order
CLOUD_UPLOAD=true                           # Enable uploads after scans

# --- DigitalOcean Spaces (Primary) ---
DO_ENABLED=true
DO_SPACES_BUCKET=exitmap-dns-results
DO_SPACES_KEY=your_spaces_key
DO_SPACES_SECRET=your_spaces_secret
DO_SPACES_REGION=nyc3                       # nyc3, sfo3, ams3, sgp1, fra1
DO_SPACES_CDN=false                         # true = CDN (cached), false = origin

# --- Cloudflare R2 (Backup) ---
R2_ENABLED=true
R2_BUCKET=exitmap-dns-results
R2_ACCESS_KEY_ID=your_r2_key
R2_SECRET_ACCESS_KEY=your_r2_secret

# =============================================================================
# CACHE TTL (seconds)
# =============================================================================
CACHE_TTL_LATEST=60                         # latest.json, files.json
CACHE_TTL_HISTORICAL=31536000               # Historical files (1 year, immutable)

# =============================================================================
# RCLONE SETTINGS
# =============================================================================
RCLONE_PATH=$HOME/bin/rclone
RCLONE_TRANSFERS=128                        # R2 parallelism (no rate limit)
RCLONE_CHECKERS=256
DO_RCLONE_TRANSFERS=56                      # DO Spaces (rate limited)
DO_RCLONE_CHECKERS=80

# =============================================================================
# PATHS
# =============================================================================
OUTPUT_DIR=$HOME/exitmap/results            # Scan output directory
LOG_DIR=$HOME/exitmap/logs                  # Log files
BACKUP_DIR=$HOME/exitmap-deploy/backups     # Local backups

# =============================================================================
# SCAN SETTINGS
# =============================================================================
# Seconds between circuit builds (0 = fastest, higher = gentler)
BUILD_DELAY=0
DELAY_NOISE=0                               # Random variance added to delay

# Your controlled relay fingerprint for first hop (recommended)
# When set, tracked in results for accountability
FIRST_HOP=

# Use reliable guards for random first-hop selection
# Filters to GUARD+STABLE+FAST+RUNNING+VALID with â‰¥5MB/s bandwidth
RELIABLE_FIRST_HOP=false

# Include BadExit relays in scan
ALL_EXITS=true

# =============================================================================
# DNS VALIDATION SETTINGS
# =============================================================================
# Wildcard domain - *.domain must resolve to DNS_EXPECTED_IP
# Leave defaults to use 1aeo.com infrastructure
# DNS_WILDCARD_DOMAIN=tor.exit.validator.1aeo.com
# DNS_EXPECTED_IP=64.65.4.1

# Timing (optimal defaults from experiments)
# DNS_QUERY_TIMEOUT=45                      # Seconds per query
# DNS_MAX_RETRIES=3                         # Retry attempts per relay
# DNS_HARD_TIMEOUT=180                      # Max seconds for entire probe
# DNS_RETRY_DELAY=1.0                       # Seconds between retries

# =============================================================================
# AUTOMATION
# =============================================================================
CLEANUP_OLD=true                            # Remove old analysis dirs (>7 days)
CRON_SCHEDULE="0 */6 * * *"                 # Every 6 hours

# Bootstrap retry settings
BOOTSTRAP_TIMEOUT=90                        # Seconds to wait for Tor bootstrap
MAX_BOOTSTRAP_RETRIES=3                     # Retry attempts on failure
PROGRESS_CHECK_INTERVAL=10                  # Seconds between progress checks
